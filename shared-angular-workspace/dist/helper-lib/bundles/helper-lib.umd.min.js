!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("rxjs"),require("fingerprintjs2"),require("cryptography-ts"),require("cryptography-ts/bin/utils"),require("publiq-models-ts/bin/models/PubliqTransaction"),require("@angular/common/http"),require("rxjs/operators")):"function"==typeof define&&define.amd?define("helper-lib",["exports","@angular/core","rxjs","fingerprintjs2","cryptography-ts","cryptography-ts/bin/utils","publiq-models-ts/bin/models/PubliqTransaction","@angular/common/http","rxjs/operators"],t):t((e=e||self)["helper-lib"]={},e.ng.core,e.rxjs,e.fingerprintjs2,e.cryptographyTs,e.utils,e.PubliqTransaction,e.ng.common.http,e.rxjs.operators)}(this,(function(e,t,r,n,i,o,a,p,s){"use strict";a=a&&a.hasOwnProperty("default")?a["default"]:a;var u=function(){function e(){}return e.decorators=[{type:t.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[]},e.ngInjectableDef=t.ɵɵdefineInjectable({factory:function(){return new e},token:e,providedIn:"root"}),e}(),c=function(){function e(){}return e.prototype.ngOnInit=function(){},e.decorators=[{type:t.Component,args:[{selector:"helper-helper-lib",template:"\n    <p>\n      helper-lib works!\n    </p>\n  "}]}],e.ctorParameters=function(){return[]},e}(),l={get:"get",post:"post",put:"put","delete":"delete"},y=function(){function e(e){this.http=e}return e.setBaseHeaders=function(t){e.baseHeaders=t},e.prototype.customCall=function(e,t,r,n,i){return void 0===i&&(i=!1),this.call(e,t,r,n,i,!1)},e.prototype.call=function(t,r,n,i,o,a){void 0===o&&(o=!1),void 0===a&&(a=!0);var s={};a&&e.baseHeaders&&e.baseHeaders.forEach((function(e){e.getHeaderValue()&&(s[e.headerKay]=e.getHeaderValue())})),i&&i.forEach((function(e){e.value&&(s[e.key]=e.value)}));var u={};if(s&&Object.keys(s).length){var c=new p.HttpHeaders(s);u.headers=c}return o&&(u.observe="response"),t===l.get||t===l["delete"]?this.http[t](r,u):this.http[t](r,n,u)},e.baseHeaders=[],e.decorators=[{type:t.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[{type:p.HttpClient}]},e.ngInjectableDef=t.ɵɵdefineInjectable({factory:function(){return new e(t.ɵɵinject(p.HttpClient))},token:e,providedIn:"root"}),e}(),d=function(){function e(e,t){if(this.httpHelper=e,!t)throw new Error("OauthService: oauthUrl not valid");this.url=t+"/api/user",this.generateRandomKey()}return e.getSignetString=function(t,r){var n=new Date(new Date(1e3*t)),o=new Date(n.getTime()+e.DATA_RANG),p=new i.KeyPair(r.trim()),s=new a({creation:+n,expiry:+o,fee:{whole:0,fraction:0},action:{}});return p.signMessage(JSON.stringify(s.toJson()))},e.prototype.signupConfirmation=function(e){var t=this.url+"/signup/confirmation/"+e;return this.httpHelper.customCall(l.get,t)},e.prototype.signupComplete=function(t,r,n){i.KeyPair.setRandomKey(this.randomKey);var o=new i.KeyPair,a=o.getEncryptedBrainKeyByPassword(n),p=o.PpublicKey,s=e.getSignetString(t,o.BrainKey);this.brainKey=o.BrainKey;var u=this.url+"/signup/complete";return this.httpHelper.customCall(l.post,u,{confirmationCode:r,brainKey:a,publicKey:p,signedString:s})},e.prototype.signinCheckCode=function(e){var t=this.url+"/signin/check-code/"+e;return this.httpHelper.customCall(l.get,t)},e.prototype.authenticate=function(e,t,r){void 0===t&&(t=!1),void 0===r&&(r="");var n=this.url+"/authentication",i={email:e};return r&&(i.relativeRoute=r),this.httpHelper.customCall(l.put,n,i,null,t)},e.prototype.signinGetToken=function(t,n,o,a){var p=this,u=i.KeyPair.decryptBrainKeyByPassword(t,a);if(!u.isValid)return r.throwError("oauth_decrypt_brain_key");var c=u.brainKey,y=new i.KeyPair(c.trim()),d=e.getSignetString(n,y.BrainKey),g=this.url+"/signin/get-token";return this.brainKey=c.trim(),this.httpHelper.customCall(l.post,g,{code:o,signedString:d}).pipe(s.map((function(e){return p.brainKeySaved=!!e.brainKeySaved,p.brainKeySeen=!!e.brainKeySeen,p.privateKeySaved=!!e.privateKeySaved,e})))},e.prototype.recoverAuthenticate=function(e){var t=new i.KeyPair(e.trim()).PpublicKey,r=this.url+"/recover/authenticate/"+t;return this.httpHelper.customCall(l.get,r)},e.prototype.recoverComplete=function(t,r,n){var o=this,a=new i.KeyPair(t.trim()),p=a.getEncryptedBrainKeyByPassword(n),u=a.PpublicKey,c=e.getSignetString(r,a.BrainKey);this.brainKey=a.BrainKey;var y=this.url+"/recover/complete";return this.httpHelper.customCall(l.post,y,{brainKey:p,publicKey:u,signedString:c}).pipe(s.map((function(e){return o.brainKeySaved=!!e.brainKeySaved,o.brainKeySeen=!!e.brainKeySeen,o.privateKeySaved=!!e.privateKeySaved,e})))},e.prototype.getSignedData=function(t,r){var n=new Date,o=new Date(n.getTime()+e.DATA_RANG),p=new i.KeyPair(t.trim()),s=new a({creation:+n,expiry:+o,fee:{whole:0,fraction:0},action:r});return{signedJson:JSON.stringify(s.toJson()),signedString:p.signMessage(JSON.stringify(s.toJson())),creation:Math.floor(n.getTime()/1e3),expiry:Math.floor(o.getTime()/1e3)}},e.prototype.getSignedEmptyObject=function(e){var t=new i.KeyPair(e.trim()),r=this.getSignedData(e.trim(),{});return{publicKey:t.PpublicKey,signedString:r.signedString,creationDate:r.creation}},e.prototype.setBrainKeySeen=function(e){var t=this,r=this.url+"/brain-key-seen",n=this.getSignedEmptyObject(e.trim());return this.httpHelper.customCall(l.post,r,n).pipe(s.map((function(e){return t.brainKeySeen=!0,e})))},e.prototype.setBrainKeySaved=function(e){var t=this,r=this.url+"/brain-key-saved",n=this.getSignedEmptyObject(e.trim());return this.httpHelper.customCall(l.post,r,n).pipe(s.map((function(e){return t.brainKeySeen=!0,t.brainKeySaved=!0,e})))},e.prototype.setPrivateKeySaved=function(e){var t=this,r=this.url+"/private-key-saved",n=this.getSignedEmptyObject(e.trim());return this.httpHelper.customCall(l.post,r,n).pipe(s.map((function(e){return t.privateKeySaved=!0,e})))},e.prototype.generateRandomKey=function(){var e=this;n.get({},(function(t){var r=""+n.x64hash128(t.map((function(e){return e.value})).join(""),31).trim()+(new Date).getTime(),i=o.stringToSha256(r).substring(0,8);e.randomKey=parseInt(i,16)}))},e.DATA_RANG=36e5,e.decorators=[{type:t.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[{type:y},{type:String,decorators:[{type:t.Inject,args:["oauthUrl"]}]}]},e.ngInjectableDef=t.ɵɵdefineInjectable({factory:function(){return new e(t.ɵɵinject(y),t.ɵɵinject("oauthUrl"))},token:e,providedIn:"root"}),e}(),g=function(){function e(){}return e.prototype.observerCall=function(e,t,n){var i=this;return void 0===n&&(n=!1),!n&&this.hasOwnProperty(e)?r.of(this[e]):t.pipe(s.map((function(t){return i[e]=t,t})))},e.decorators=[{type:t.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[]},e.ngInjectableDef=t.ɵɵdefineInjectable({factory:function(){return new e},token:e,providedIn:"root"}),e}(),h=function(){function e(){}return e.decorators=[{type:t.NgModule,args:[{declarations:[c],imports:[],providers:[d,y,g],exports:[c]}]}],e}();e.HelperLibComponent=c,e.HelperLibModule=h,e.HelperLibService=u,e.HttpHelperService=y,e.HttpMethodTypes=l,e.HttpObserverService=g,e.OauthService=d,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=helper-lib.umd.min.js.map